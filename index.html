<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ESP32 Lab Pro - Encyclop√©die Compl√®te</title>
    <style>
        :root {
            --bg: #0f172a; --card: #1e293b; --primary: #6366f1;
            --success: #22c55e; --danger: #ef4444; --text: #f8fafc;
            --accent: #38bdf8;
        }

        body { 
            font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); 
            margin: 0; padding-bottom: 80px; overflow-x: hidden;
        }

        .app-bar {
            background: var(--card); padding: 15px 20px;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            position: sticky; top: 0; z-index: 500;
        }

        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; height: 70px;
            background: var(--card); display: flex; justify-content: space-around;
            align-items: center; border-top: 1px solid rgba(255,255,255,0.1);
            z-index: 1000;
        }

        .nav-btn { background: none; border: none; color: #94a3b8; font-size: 11px; text-align: center; flex: 1; cursor: pointer; }
        .nav-btn.active { color: var(--primary); font-weight: bold; }
        .nav-icon { font-size: 24px; display: block; margin-bottom: 4px; }

        .view { display: none; padding: 20px; animation: fadeIn 0.2s; }
        .active-view { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .card { 
            background: var(--card); border-radius: 15px; padding: 20px; margin-bottom: 15px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .folder-item {
            background: var(--card); border-radius: 12px; padding: 12px;
            display: flex; align-items: center; gap: 15px; margin-bottom: 10px;
            border-left: 5px solid var(--primary); cursor: pointer;
        }

        .folder-thumb { width: 55px; height: 55px; border-radius: 10px; object-fit: cover; background: #0f172a; display: flex; align-items: center; justify-content: center; font-size: 24px;}
        .status-badge { font-size: 10px; padding: 3px 10px; border-radius: 12px; font-weight: bold; text-transform: uppercase;}
        .status-prep { background: #334155; color: #94a3b8; }
        .status-done { background: var(--success); color: white; }

        input, textarea { 
            width: 100%; background: #0f172a; border: 1px solid #334155; 
            color: white; padding: 12px; border-radius: 10px; box-sizing: border-box; margin: 8px 0; font-size: 14px;
        }

        .btn { 
            width: 100%; padding: 15px; border-radius: 12px; border: none;
            color: white; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.2s;
        }
        .btn:active { transform: scale(0.98); }

        .modal { position: fixed; inset: 0; background: var(--bg); z-index: 2000; display: none; flex-direction: column; }
        .modal-header { padding: 15px 20px; border-bottom: 1px solid #334155; display: flex; align-items: center; justify-content: space-between; background: var(--card); }
        
        .code-editor { background: #000; color: #22c55e; font-family: 'Courier New', monospace; height: 250px; border: 1px solid var(--primary); padding: 12px; font-size: 12px; line-height: 1.4;}
        .img-preview { width: 100%; height: 200px; border-radius: 15px; object-fit: cover; margin-bottom: 15px; background: #000; border: 1px solid #334155;}

        .formula-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
        .formula-item {
            background: var(--card); padding: 18px; border-radius: 15px;
            display: flex; justify-content: space-between; align-items: center;
            border: 1px solid rgba(255,255,255,0.05); cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="view-home" class="view active-view">
        <div class="app-bar"><h2>ESP32 <span style="color:var(--primary)">Lab</span></h2><button onclick="openModal('modal-wifi')" style="background:none; border:none; font-size:24px;">üì∂</button></div>
        <div class="card" style="margin-top:20px;">
            <h3>üïπÔ∏è Contr√¥le Direct</h3>
            <p id="home-status" style="font-size:13px; color:var(--accent);">IP: Non configur√©e</p>
            <div style="display:flex; gap:10px;">
                <button class="btn" style="background:var(--success)" onclick="sendCmd('led?status=ON')">ALLUMER</button>
                <button class="btn" style="background:var(--danger)" onclick="sendCmd('led?status=OFF')">√âTEINDRE</button>
            </div>
        </div>
    </div>

    <div id="view-folders" class="view">
        <div class="app-bar"><h2>Mes Projets</h2><button onclick="newFolder()" style="background:var(--primary); color:white; border:none; padding:10px 20px; border-radius:10px; font-weight:bold;">+ NOUVEAU</button></div>
        <div id="folder-list" style="margin-top:15px;"></div>
    </div>

    <div id="view-tools" class="view">
        <div class="app-bar"><h2>Engineering</h2></div>
        <p style="font-size:12px; color:#94a3b8; margin: 10px 0 20px 0;">Encyclop√©die technique et calculateurs temps-r√©el.</p>
        <div class="formula-grid" id="formula-list"></div>
    </div>

    <div id="modal-calc" class="modal">
        <div class="modal-header">
            <button onclick="closeModal('modal-calc')" style="color:var(--primary); background:none; border:none; font-weight:bold; font-size:16px;">‚úï Fermer</button>
            <h3 id="calc-title" style="margin:0">Calcul</h3><div style="width:40px"></div>
        </div>
        <div style="padding: 20px; overflow-y: auto; flex: 1;">
            <div class="card" style="border: 1px solid var(--accent);">
                <div id="calc-inputs"></div>
                <div style="text-align: center; margin-top:20px; border-top:1px solid #334155; padding-top:15px;">
                    <div style="font-size:11px; color:var(--accent); font-weight:bold; letter-spacing:1px;">R√âSULTAT</div>
                    <div id="calc-res" style="font-size: 32px; font-family: 'Courier New', monospace; font-weight:bold; color:#fff;">---</div>
                </div>
            </div>
            <div class="card" style="border-left: 5px solid var(--primary); background: rgba(99, 102, 241, 0.05);">
                <b style="color:var(--primary); font-size:16px; display:block; margin-bottom:8px;">üìú Histoire / Contexte</b>
                <p id="calc-hist" style="font-size:14px; color:#cbd5e1; line-height:1.6; margin-bottom:20px;"></p>
                <b style="color:var(--primary); font-size:16px; display:block; margin-bottom:8px;">‚öôÔ∏è Fonctionnement</b>
                <p id="calc-func" style="font-size:14px; color:#cbd5e1; line-height:1.6;"></p>
            </div>
        </div>
    </div>

    <div id="modal-project" class="modal">
        <div class="modal-header">
            <button onclick="closeModal('modal-project')" style="color:var(--primary); background:none; border:none; font-weight:bold; font-size:16px;">‚Üê Retour</button>
            <h3 id="edit-title">D√©tails</h3>
            <button onclick="saveProject()" style="background:var(--success); color:white; border:none; padding:8px 15px; border-radius:10px; font-weight:bold;">ENREGISTRER</button>
        </div>
        <div style="padding: 20px; overflow-y: auto; flex: 1;">
            <img id="proj-img-preview" class="img-preview" style="display:none;">
            <label for="img-upload" style="background:#334155; color:white; padding:12px; border-radius:10px; display:block; text-align:center; cursor:pointer; margin-bottom:20px; font-weight:bold;">üì∏ Ajouter / Modifier Photo</label>
            <input type="file" id="img-upload" accept="image/*" style="display:none" onchange="previewFile()">
            
            <label style="color:var(--accent); font-weight:bold; font-size:12px;">NOTES DU PROJET (PINOUT, SCH√âMAS...)</label>
            <textarea id="edit-notes" rows="5" placeholder="Saisissez vos notes ici..."></textarea>
            
            <label style="color:var(--accent); font-weight:bold; font-size:12px; margin-top:15px; display:block;">CODE ARDUINO (WiFiManager v2.0.17)</label>
            <textarea id="edit-code" class="code-editor" spellcheck="false" placeholder="// Collez votre code ici..."></textarea>
            
            <button id="btn-done" class="btn" onclick="toggleStatus()"></button>
            <button class="btn" style="background:none; color:var(--danger); border: 1px solid var(--danger); margin-top:20px;" onclick="deleteFolder()">SUPPRIMER LE PROJET</button>
        </div>
    </div>

    <div id="modal-wifi" class="modal">
        <div class="modal-header"><h3>Configuration R√©seau</h3><button onclick="closeModal('modal-wifi')" style="background:none; border:none; color:white; font-size:20px;">‚úï</button></div>
        <div style="padding: 20px;">
            <label>Adresse IP de l'ESP32</label>
            <input type="text" id="ip-input" placeholder="Ex: 192.168.1.50">
            <button class="btn" style="background:var(--primary)" onclick="saveWifi()">CONNECTER L'APPLICATION</button>
            <p style="font-size:12px; color:#94a3b8; margin-top:20px; line-height:1.4;">L'ESP32 doit √™tre sur le m√™me r√©seau et utiliser la biblioth√®que <b>WiFiManager par tzapu (v-2.0.17)</b>.</p>
        </div>
    </div>

    <nav class="bottom-nav">
        <button class="nav-btn active" id="nav-home" onclick="switchView('view-home')"><span class="nav-icon">üè†</span>Accueil</button>
        <button class="nav-btn" id="nav-folders" onclick="switchView('view-folders')"><span class="nav-icon">üìÇ</span>Projets</button>
        <button class="nav-btn" id="nav-tools" onclick="switchView('view-tools')"><span class="nav-icon">üßÆ</span>Outils</button>
    </nav>

    <script>
        let db = JSON.parse(localStorage.getItem('lab_pro_db')) || [];
        let currentIdx = null;
        let tempImg = "";

        // --- TOUTES LES FORMULES : ANCIENNES + NOUVELLES DU DOCUMENT ---
        const formulas = [
            // ANCIENNES FORMULES
            { id:'ohm', name:"Loi d'Ohm", math:"U = R √ó I", hist: "Georg Ohm (1827). Base absolue de l'√©lectricit√©.", func: "Relie la Tension, le Courant et la R√©sistance.", ins:[{id:'u',n:'U (V)'},{id:'i',n:'I (A)'},{id:'r',n:'R (Œ©)'}]},
            { id:'pwr', name:"Puissance DC", math:"P = U √ó I", hist: "James Watt. Calcule l'√©nergie consomm√©e par seconde.", func: "Crucial pour dimensionner les alimentations.", ins:[{id:'p',n:'P (W)'},{id:'u',n:'U (V)'},{id:'i',n:'I (A)'}]},
            { id:'led', name:"R√©sistance LED", math:"R = (Vcc-Vl)/Il", hist: "Application directe pour prot√©ger vos LED.", func: "√âvite de br√ªler les pins de l'ESP32.", ins:[{id:'vcc',n:'Vcc (V)'},{id:'vl',n:'Vled (V)'},{id:'il',n:'Iled (A)'}]},
            { id:'div', name:"Pont Diviseur", math:"Vs = Ve*(R2/Rt)", hist: "M√©thode classique de r√©duction de tension.", func: "Permet de lire 12V avec un ADC 3.3V.", ins:[{id:'ve',n:'Ve (V)'},{id:'r1',n:'R1 (Œ©)'},{id:'r2',n:'R2 (Œ©)'}]},
            { id:'adc', name:"ADC ESP32 (12-bit)", math:"V = (X/4095)*3.3", hist: "L'ESP32 a une r√©solution de 4096 paliers.", func: "Convertit la valeur brute du capteur en Volts.", ins:[{id:'x',n:'Valeur (0-4095)'}]},
            { id:'dac', name:"DAC ESP32 (8-bit)", math:"V = (X/255)*3.3", hist: "Pins 25 et 26 uniquement.", func: "G√©n√®re une tension r√©elle √† partir d'un code.", ins:[{id:'x',n:'Valeur (0-255)'}]},
            { id:'rc', name:"Coupure RC", math:"fc = 1/2œÄRC", hist: "Filtrage des signaux parasites.", func: "Calcule la fr√©quence de coupure d'un filtre.", ins:[{id:'r',n:'R (Œ©)'},{id:'c',n:'C (F)'}]},
            { id:'bat', name:"Autonomie Batterie", math:"T = Cap/Conso", hist: "Estimation de long√©vit√©.", func: "Estime la dur√©e de vie du projet en heures.", ins:[{id:'cap',n:'Capacit√© (mAh)'},{id:'con',n:'Conso (mA)'}]},
            { id:'freq', name:"Fr√©quence/P√©riode", math:"f = 1/T", hist: "Base des timers et PWM.", func: "Convertit le temps d'un cycle en Hertz.", ins:[{id:'t',n:'P√©riode (s)'}]},
            { id:'wave', name:"Longueur d'onde Œª", math:"Œª = c/f", hist: "James Clerk Maxwell.", func: "Calcule la taille d'une onde (WiFi/LoRa).", ins:[{id:'f',n:'Fr√©quence (MHz)'}]},
            { id:'dbm', name:"dBm vers mW", math:"10^(P/10)", hist: "Graham Bell.", func: "Convertit la puissance du signal WiFi.", ins:[{id:'dbm',n:'Puissance (dBm)'}]},
            { id:'pwm', name:"Tension Moy. PWM", math:"Vcc * Duty", hist: "Contr√¥le de vitesse/luminosit√©.", func: "Tension r√©sultante du hachage.", ins:[{id:'vcc',n:'Vcc (V)'},{id:'d',n:'Duty Cycle (%)'}]},
            { id:'c_par', name:"Condos //", math:"C1 + C2", hist: "Stockage cumul√©.", func: "Capacit√© √©quivalente en parall√®le.", ins:[{id:'c1',n:'C1'},{id:'c2',n:'C2'}]},
            { id:'react_c', name:"R√©actance Capa", math:"1/2œÄfC", hist: "R√©sistance complexe alternative.", func: "Imp√©dance d'un condensateur selon f.", ins:[{id:'f',n:'Hz'},{id:'c',n:'F'}]},
            { id:'react_l', name:"R√©actance Induc", math:"2œÄfL", hist: "Joseph Henry.", func: "Blocage des hautes fr√©quences par bobine.", ins:[{id:'f',n:'Hz'},{id:'l',n:'H'}]},
            { id:'chg', name:"Temps de Charge", math:"Cap / I_chg", hist: "Chargeur Li-Ion.", func: "Temps pour remplir une batterie.", ins:[{id:'cap',n:'mAh'},{id:'ichg',n:'Courant (mA)'}]},
            { id:'pullup', name:"Pull-up", math:"V / R", hist: "Logique TTL.", func: "Courant circulant dans une pull-up.", ins:[{id:'vcc',n:'Vcc'},{id:'r',n:'R'}]},
            { id:'torque', name:"Couple/Puis.", math:"P / œâ", hist: "M√©canique Newtonienne.", func: "Lien entre force rotative et puissance.", ins:[{id:'p',n:'Watts'},{id:'w',n:'Vitesse (rad/s)'}]},

            // NOUVELLES FORMULES DU DOCUMENT PDF
            { id:'pouillet', name:"Loi de Pouillet", math:"R = (œÅ √ó L) / S", hist: "Claude Pouillet (1837). D√©pend de la nature, longueur et section.", func: "Calcule la r√©sistance d'un fil (Cuivre: œÅ=0.017).", ins:[{id:'rho',n:'œÅ (Resistivit√©)'},{id:'l',n:'L (m)'},{id:'s',n:'S (mm¬≤)'}]},
            { id:'mathiessen', name:"Loi de Mathiessen", math:"Rt = R0(1 + Œ±t)", hist: "Variation de r√©sistance avec la temp√©rature.", func: "Pr√©dit la r√©sistance √† chaud. Œ± (cuivre)=0.0039.", ins:[{id:'r0',n:'R √† 0¬∞C'},{id:'alpha',n:'Œ±'},{id:'t',n:'Temp. (¬∞C)'}]},
            { id:'qty_curr', name:"Quantit√© de courant", math:"Q = I √ó t", hist: "Charge √©lectrique stock√©e.", func: "Calcule la charge totale en Coulombs.", ins:[{id:'i',n:'I (A)'},{id:'t',n:'Temps (s)'}]},
            { id:'section_geom', name:"Section Circulaire", math:"S = œÄ √ó r¬≤", hist: "G√©om√©trie des conducteurs.", func: "Trouve la section S pour la loi de Pouillet.", ins:[{id:'r',n:'Rayon (mm)'}]},
            { id:'res_serie', name:"R√©sistances S√©rie", math:"R1 + R2 + ...", hist: "Loi des mailles.", func: "Somme des r√©sistances bout √† bout.", ins:[{id:'r1',n:'R1'},{id:'r2',n:'R2'}]},
            { id:'res_para', name:"R√©sistances //", math:"(R1*R2)/(R1+R2)", hist: "Loi des n≈ìuds.", func: "R√©sistance √©quivalente c√¥te √† c√¥te.", ins:[{id:'r1',n:'R1'},{id:'r2',n:'R2'}]},
            { id:'joule_doc', name:"Loi de Joule", math:"Q = R*I¬≤*t", hist: "James Joule (1841).", func: "Chaleur dissip√©e en Joules.", ins:[{id:'r',n:'R'},{id:'i',n:'I'},{id:'t',n:'s'}]}
        ];

        // --- NAVIGATION ---
        function switchView(id) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active-view'));
            document.getElementById(id).classList.add('active-view');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('nav-' + id.split('-')[1]).classList.add('active');
            if(id==='view-tools') renderTools();
            if(id==='view-folders') renderFolders();
        }

        // --- OUTILS & CALCULS ---
        function renderTools() {
            const list = document.getElementById('formula-list');
            list.innerHTML = formulas.map((f, i) => `
                <div class="formula-item" onclick="openCalc(${i})">
                    <div><b>${f.name}</b><br><span style="font-family:monospace; color:var(--accent); font-size:11px;">${f.math}</span></div>
                    <span style="color:var(--primary); font-size:20px;">‚ûî</span>
                </div>
            `).join('');
        }

        function openCalc(idx) {
            const f = formulas[idx];
            document.getElementById('calc-title').innerText = f.name;
            document.getElementById('calc-hist').innerText = f.hist;
            document.getElementById('calc-func').innerText = f.func;
            document.getElementById('calc-res').innerText = "---";
            document.getElementById('calc-inputs').innerHTML = f.ins.map(inp => `
                <label style="font-size:11px; color:var(--accent); font-weight:bold; text-transform:uppercase;">${inp.n}</label>
                <input type="number" id="m-${inp.id}" placeholder="0" oninput="runMath('${f.id}')">
            `).join('');
            openModal('modal-calc');
        }

        function runMath(id) {
            const g = (k) => parseFloat(document.getElementById('m-'+k).value);
            const res = document.getElementById('calc-res');
            let out = "---";
            try {
                // ANCIENS CALCULS
                if(id==='ohm') { let u=g('u'), i=g('i'), r=g('r'); if(u&&i) out=(u/i).toFixed(2)+"Œ©"; else if(i&&r) out=(i*r).toFixed(2)+"V"; else if(u&&r) out=(u/r).toFixed(3)+"A"; }
                if(id==='pwr') { let u=g('u'), i=g('i'); if(u&&i) out=(u*i).toFixed(2)+"W"; }
                if(id==='led') { let v=g('vcc'), vl=g('vl'), il=g('il'); if(v&&vl&&il) out=((v-vl)/il).toFixed(1)+"Œ©"; }
                if(id==='div') { let ve=g('ve'), r1=g('r1'), r2=g('r2'); if(ve&&r1&&r2) out=(ve*(r2/(r1+r2))).toFixed(2)+"V"; }
                if(id==='adc') { let x=g('x'); if(x>=0) out=((x/4095)*3.3).toFixed(3)+"V"; }
                if(id==='dac') { let x=g('x'); if(x>=0) out=((x/255)*3.3).toFixed(2)+"V"; }
                if(id==='bat') { let c=g('cap'), co=g('con'); if(c&&co) out=(c/co).toFixed(1)+"h"; }
                if(id==='rc') { let r=g('r'), c=g('c'); if(r&&c) out=(1/(2*Math.PI*r*c)).toFixed(1)+"Hz"; }
                if(id==='freq') { let t=g('t'); if(t) out=(1/t).toFixed(1)+"Hz"; }
                if(id==='pwm') { let v=g('vcc'), d=g('d'); if(v&&d) out=(v*(d/100)).toFixed(2)+"V"; }
                
                // NOUVEAUX CALCULS DU DOCUMENT
                if(id==='pouillet') { let r=g('rho'), l=g('l'), s=g('s'); if(r&&l&&s) out=(r*l/s).toFixed(4)+" Œ©"; }
                if(id==='mathiessen') { let r0=g('r0'), a=g('alpha'), t=g('t'); if(r0&&a&&t) out=(r0*(1+(a*t))).toFixed(3)+" Œ©"; }
                if(id==='qty_curr') { let i=g('i'), t=g('t'); if(i&&t) out=(i*t).toFixed(2)+" C"; }
                if(id==='section_geom') { let r=g('r'); if(r) out=(Math.PI*r*r).toFixed(3)+" mm¬≤"; }
                if(id==='res_serie') { let r1=g('r1'), r2=g('r2'); if(r1||r2) out=((r1||0)+(r2||0)).toFixed(1)+" Œ©"; }
                if(id==='res_para') { let r1=g('r1'), r2=g('r2'); if(r1&&r2) out=((r1*r2)/(r1+r2)).toFixed(2)+" Œ©"; }
                if(id==='joule_doc') { let r=g('r'), i=g('i'), t=g('t'); if(r&&i&&t) out=(r*i*i*t).toFixed(0)+" J"; }
                
            } catch(e){}
            res.innerText = (out.includes("NaN") || out.includes("Infinity")) ? "---" : out;
        }

        // --- GESTION PROJETS ---
        function renderFolders() {
            const list = document.getElementById('folder-list'); 
            list.innerHTML = "";
            db.forEach((f, i) => {
                const sClass = f.status === 'done' ? 'status-done' : 'status-prep';
                const thumb = f.img ? `<img src="${f.img}" class="folder-thumb">` : `<div class="folder-thumb">üìÅ</div>`;
                list.innerHTML += `<div class="folder-item" onclick="openFolder(${i})">${thumb}<div style="flex:1"><b>${f.name}</b><br><span class="status-badge ${sClass}">${f.status=='done'?'Termin√©':'En cours'}</span></div><span style="color:var(--primary)">‚ûî</span></div>`;
            });
        }

        function openFolder(i) {
            currentIdx = i; const f = db[i];
            document.getElementById('edit-title').innerText = f.name;
            document.getElementById('edit-notes').value = f.notes || "";
            document.getElementById('edit-code').value = f.code || "";
            tempImg = f.img || "";
            const prev = document.getElementById('proj-img-preview');
            prev.src = tempImg; prev.style.display = tempImg ? 'block' : 'none';
            updateStatusUI(f.status); 
            openModal('modal-project');
        }

        function newFolder() {
            const n = prompt("Nom du nouveau projet ?");
            if(n && n.trim() !== "") {
                db.push({name: n.trim(), status: 'prep', notes: '', code: '', img: ''});
                localStorage.setItem('lab_pro_db', JSON.stringify(db));
                renderFolders();
            }
        }

        function saveProject() {
            db[currentIdx].notes = document.getElementById('edit-notes').value;
            db[currentIdx].code = document.getElementById('edit-code').value;
            db[currentIdx].img = tempImg;
            localStorage.setItem('lab_pro_db', JSON.stringify(db));
            renderFolders(); closeModal('modal-project');
        }

        function deleteFolder() {
            if(confirm("Supprimer ce projet ?")) {
                db.splice(currentIdx, 1);
                localStorage.setItem('lab_pro_db', JSON.stringify(db));
                renderFolders(); closeModal('modal-project');
            }
        }

        function previewFile() { 
            const file = document.getElementById('img-upload').files[0]; 
            const reader = new FileReader(); 
            reader.onloadend = () => { tempImg = reader.result; const p = document.getElementById('proj-img-preview'); p.src = tempImg; p.style.display = 'block'; }; 
            if(file) reader.readAsDataURL(file); 
        }

        function toggleStatus() { db[currentIdx].status = db[currentIdx].status === 'done' ? 'prep' : 'done'; updateStatusUI(db[currentIdx].status); }
        function updateStatusUI(s) { const b = document.getElementById('btn-done'); b.innerText = s === 'done' ? "‚úÖ PROJET TERMIN√â" : "MARQUER COMME FINI"; b.style.background = s === 'done' ? "var(--success)" : "#334155"; }

        // --- WIFI ---
        function saveWifi() { 
            const ip = document.getElementById('ip-input').value; 
            localStorage.setItem('lab_ip', ip); 
            document.getElementById('home-status').innerText = "IP: " + ip; 
            closeModal('modal-wifi'); 
            alert("IP enregistr√©e !");
        }

        function sendCmd(path) { 
            const ip = localStorage.getItem('lab_ip'); 
            if(!ip) return alert("Configurez l'IP !");
            fetch(`http://${ip}/${path}`, { mode: 'no-cors' }).catch(() => alert("ESP32 injoignable")); 
        }

        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        
        window.onload = () => { 
            const ip = localStorage.getItem('lab_ip'); 
            if(ip) { document.getElementById('ip-input').value = ip; document.getElementById('home-status').innerText = "IP: " + ip; }
            renderFolders(); renderTools();
        };
    </script>
</body>
</html>
